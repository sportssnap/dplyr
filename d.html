<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>SportsSnap Video Player</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/dplayer@1.27.0/dist/DPlayer.min.css" />
  <style>
    body {
      margin: 0;
      background: #111;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
    }
    #dplayer-container {
      width: 100%;
      max-width: 960px;
    }
    #dplayer {
      width: 100%;
    }
  </style>
</head>
<body>
  <div id="dplayer-container">
    <div id="dplayer"></div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/hls.js@1.5.15/dist/hls.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dplayer@1.27.0/dist/DPlayer.min.js"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const key = urlParams.get('sportssnap');

    fetch('https://sportssnap.github.io/stream/l.html')
      .then(res => res.json())
      .then(mapping => {
        const videoUrl = mapping[key];
        if (!videoUrl) {
          document.body.innerHTML = `<h2 style="color:white;text-align:center;">No video found for: ${key}</h2>`;
          return;
        }

        const dp = new DPlayer({
          container: document.getElementById('dplayer'),
          autoplay: false,
          theme: '#1e90ff',
          screenshot: true,
          hotkey: true,
          volume: 0.8,
          video: {
            url: videoUrl,
            type: 'customHls',
          }
        });

        dp.options.video.customType = {
          customHls: function (video, player) {
            if (Hls.isSupported()) {
              const hls = new Hls();
              hls.loadSource(video.src);
              hls.attachMedia(video);
            } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
              video.src = video.src;
            }
          }
        };
      })
      .catch(err => {
        document.body.innerHTML = `<h2 style="color:white;text-align:center;">Failed to load video list</h2>`;
        console.error(err);
      });
  </script>
</body>
</html>
